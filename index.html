<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>My Python Game</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/brython@3.10.2/brython.min.js"></script>
</head>
<body onload="brython()">
    <h1>My Python Game</h1>
    <script type="text/python">
import pygame
import sys
import random

pygame.init()

# Screen dimensions
WIDTH, HEIGHT = 600, 700
GRID_SIZE = 20
ROWS, COLS = (HEIGHT - 100) // GRID_SIZE, WIDTH // GRID_SIZE  # Game area below the 100px scoreboard/menu

# Basic Colors (used for UI elements)
RED = (255, 0, 0)
BLACK = (0, 0, 0)
GRAY = (150, 150, 150)
GOLD = (255, 215, 0)
SCOREBOARD_BG = (230, 230, 230)

# Global snake color (default)
snake_color = (0, 255, 0)  # Default to green

# Set up display
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Snake Game with Store, Color Selector & Obstacle Penalty")

# Fonts
font = pygame.font.Font(None, 36)
big_font = pygame.font.Font(None, 72)

# Directions
UP = (0, -1)
DOWN = (0, 1)
LEFT = (-1, 0)
RIGHT = (1, 0)
OPPOSITE = {UP: DOWN, DOWN: UP, LEFT: RIGHT, RIGHT: LEFT}

# Obstacles (initially two obstacles in grid coordinates)
obstacles = [(10, 8), (15, 12)]

# ========== Load external images ==========

# 1) Background for the play area
grass_bg = pygame.image.load("grass_bg.png").convert_alpha()
grass_bg = pygame.transform.scale(grass_bg, (WIDTH, HEIGHT - 100))

# 2) Icon for the store button
store_icon = pygame.image.load("store_icon.png").convert_alpha()
store_icon = pygame.transform.scale(store_icon, (40, 40))

# 3) Cat image for the store background
store_bg = pygame.image.load("cat_bg.png").convert_alpha()
store_bg = pygame.transform.scale(store_bg, (WIDTH, HEIGHT))

# 4) **Snake image** for the home (menu) background
snake_menu_bg = pygame.image.load("snake_menu_bg.png").convert_alpha()
snake_menu_bg = pygame.transform.scale(snake_menu_bg, (WIDTH, HEIGHT))

# ========== Define Color Options ==========
color_options = [
    ("Red", pygame.Color("#ff0000")),
    ("Blue", pygame.Color("#0000ff")),
    ("Green", pygame.Color("#00ff00")),
    ("Orange", pygame.Color("#ffa500")),
    ("White", pygame.Color("#ffffff")),
    ("Black", pygame.Color("#000000")),
    ("Yellow", pygame.Color("#ffff00")),
    ("Purple", pygame.Color("#800080")),
    ("Silver", pygame.Color("#c0c0c0")),
    ("Brown", pygame.Color("#a52a2a")),
    ("Gray", pygame.Color("#808080")),
    ("Pink", pygame.Color("#ffc0cb")),
    ("Olive", pygame.Color("#808000")),
    ("Maroon", pygame.Color("#800000")),
    ("Violet", pygame.Color("#ee82ee")),
    ("Charcoal", pygame.Color("#36454f")),
    ("Magenta", pygame.Color("#ff00ff")),
    ("Bronze", pygame.Color("#cd7f32")),
    ("Cream", pygame.Color("#fffdd0")),
    ("Gold", pygame.Color("#ffd700")),
    ("Tan", pygame.Color("#d2b48c")),
    ("Teal", pygame.Color("#008080")),
    ("Mustard", pygame.Color("#ffdb58")),
    ("Navy Blue", pygame.Color("#000080")),
    ("Coral", pygame.Color("#ff7f50")),
    ("Burgundy", pygame.Color("#800020")),
    ("Lavender", pygame.Color("#e6e6fa")),
    ("Mauve", pygame.Color("#e0b0ff")),
    ("Cyan", pygame.Color("#e0f7fa")),
    ("Peach", pygame.Color("#ffe5b4")),
    ("Rust", pygame.Color("#b7410e")),
    ("Indigo", pygame.Color("#4b0082")),
    ("Ruby", pygame.Color("#e0115f")),
    ("Lime Green", pygame.Color("#32cd32")),
    ("Salmon", pygame.Color("#fa8072")),
    ("Azure", pygame.Color("#007fff")),
    ("Beige", pygame.Color("#f5f5dc")),
    ("Copper Rose", pygame.Color("#996666")),
    ("Turquoise", pygame.Color("#40e0d0")),
    ("Aqua", pygame.Color("#00ffff")),
    ("Mint", pygame.Color("#3eb489")),
    ("Sky Blue", pygame.Color("#87ceeb")),
    ("Crimson", pygame.Color("#dc143c")),
    ("Saffron", pygame.Color("#f4c430")),
    ("Lemon Yellow", pygame.Color("#fff44f")),
    ("Grapevine", pygame.Color("#43254f")),
    ("Fuschia", pygame.Color("#ff00ff")),
    ("Amber", pygame.Color("#ffbf00")),
    ("Sea Green", pygame.Color("#2e8b57")),
    ("Dark Green", pygame.Color("#006400")),
    ("Pearl", pygame.Color("#eae0c8")),
    ("Ivory", pygame.Color("#fffff0")),
    ("Tangerine", pygame.Color("#f28500")),
    ("Garnet", pygame.Color("#733635")),
    ("Cherry Red", pygame.Color("#de3163")),
    ("Emerald", pygame.Color("#50c878")),
    ("Brunette", pygame.Color("#664238")),
    ("Sapphire", pygame.Color("#0f52ba")),
    ("Lilac", pygame.Color("#c8a2c8")),
    ("Rosewood", pygame.Color("#65000b")),
    ("Arctic Blue", pygame.Color("#0000ff")),
    ("Ash", pygame.Color("#808080")),
    ("Mocha", pygame.Color("#C0A392")),
    ("Coffee Brown", pygame.Color("#6f4e37")),
    ("Jet Black", pygame.Color("#0a0a0a")),
    ("Pista Green", pygame.Color("#00ff00"))
]

# ========== Game Classes ==========
class Snake:
    def __init__(self):
        self.body = [(5, 5)]
        self.direction = RIGHT
        self.growing = False

    def move(self):
        head_x, head_y = self.body[0]
        new_head = (head_x + self.direction[0], head_y + self.direction[1])
        new_head = (new_head[0] % COLS, new_head[1] % ROWS)
        self.body.insert(0, new_head)
        if self.growing:
            self.growing = False
        else:
            self.body.pop()

    def grow(self):
        self.growing = True

class Food:
    def __init__(self):
        self.position = self.generate_new_position()

    def generate_new_position(self):
        available_spaces = [
            (x, y) for x in range(COLS) for y in range(ROWS)
            if (x, y) not in snake.body and (x, y) not in obstacles
        ]
        if available_spaces:
            return random.choice(available_spaces)
        return None

    def respawn(self):
        self.position = self.generate_new_position()

# Game variables (reset when starting a new game)
snake = None
food = None
score = 0
level = 1
speed = 10
apple_count = 0
bonus_active = False

clock = pygame.time.Clock()

# ========== Helper Functions ==========

def reset_game():
    global snake, food, score, level, speed, apple_count, bonus_active, obstacles
    snake = Snake()
    food = Food()
    score = 0
    level = 1
    speed = 10
    apple_count = 0
    bonus_active = False
    obstacles = [(10, 8), (15, 12)]  # Reset to initial obstacles

def add_obstacle():
    if len(obstacles) < 10:
        available_spaces = [
            (x, y) for x in range(COLS) for y in range(ROWS)
            if (x, y) not in snake.body and (x, y) not in obstacles and (x, y) != food.position
        ]
        if available_spaces:
            new_obstacle = random.choice(available_spaces)
            obstacles.append(new_obstacle)

# ========== Main Screens ==========

def draw_menu():
    # **Use the snake image** for the menu background
    screen.blit(snake_menu_bg, (0, 0))

    title_text = big_font.render("SNAKE GAME", True, (255, 255, 255))
    title_rect = title_text.get_rect(center=(WIDTH // 2, HEIGHT // 2 - 100))
    screen.blit(title_text, title_rect)

    # Play button
    button_width, button_height = 140, 60
    button_x = WIDTH // 2 - button_width // 2
    button_y = HEIGHT // 2
    play_button_rect = pygame.Rect(button_x, button_y, button_width, button_height)
    pygame.draw.rect(screen, (0, 200, 0), play_button_rect, border_radius=10)
    play_text = font.render("Play", True, (255, 255, 255))
    play_rect = play_text.get_rect(center=play_button_rect.center)
    screen.blit(play_text, play_rect)

    # Store icon next to Play button
    icon_x = play_button_rect.right + 10
    icon_y = play_button_rect.centery - store_icon.get_height() // 2
    store_icon_rect = store_icon.get_rect(topleft=(icon_x, icon_y))
    screen.blit(store_icon, (icon_x, icon_y))

    pygame.display.flip()
    return play_button_rect, store_icon_rect

def draw_store():
    # Cat background for the store
    screen.blit(store_bg, (0, 0))

    store_title = big_font.render("Store", True, (255, 255, 255))
    title_rect = store_title.get_rect(center=(WIDTH // 2, 50))
    screen.blit(store_title, title_rect)

    # Draw color selection grid
    square_size = 40
    spacing = 10
    cols_grid = 8
    total_width = cols_grid * square_size + (cols_grid - 1) * spacing
    start_x = (WIDTH - total_width) // 2
    start_y = 100
    option_rects = []

    for i, (name, color_val) in enumerate(color_options):
        col = i % cols_grid
        row = i // cols_grid
        x = start_x + col * (square_size + spacing)
        y = start_y + row * (square_size + spacing)
        rect = pygame.Rect(x, y, square_size, square_size)
        pygame.draw.rect(screen, color_val, rect)
        # Outline for the currently selected color
        if color_val == snake_color:
            pygame.draw.rect(screen, BLACK, rect, 3)
        else:
            pygame.draw.rect(screen, BLACK, rect, 1)
        option_rects.append((rect, color_val))

    # Back button
    button_width, button_height = 140, 60
    button_x = WIDTH // 2 - button_width // 2
    button_y = HEIGHT - 100
    back_button_rect = pygame.Rect(button_x, button_y, button_width, button_height)
    pygame.draw.rect(screen, (200, 0, 0), back_button_rect, border_radius=10)
    back_text = font.render("Back", True, (255, 255, 255))
    back_text_rect = back_text.get_rect(center=back_button_rect.center)
    screen.blit(back_text, back_text_rect)

    pygame.display.flip()
    return back_button_rect, option_rects

def draw_game_over():
    screen.fill((0, 0, 0))
    game_over_text = big_font.render("Game Over!", True, RED)
    score_text = font.render(f"Final Score: {score}", True, (255, 255, 255))
    continue_text = font.render("Click to return to menu", True, (255, 255, 255))
    go_rect = game_over_text.get_rect(center=(WIDTH // 2, HEIGHT // 2 - 50))
    score_rect = score_text.get_rect(center=(WIDTH // 2, HEIGHT // 2))
    cont_rect = continue_text.get_rect(center=(WIDTH // 2, HEIGHT // 2 + 50))
    screen.blit(game_over_text, go_rect)
    screen.blit(score_text, score_rect)
    screen.blit(continue_text, cont_rect)
    pygame.display.flip()
    return (go_rect, score_rect, cont_rect)

# ========== Main Loop & Game States ==========

game_state = "menu"  # Possible states: "menu", "store", "playing", "game_over"
running = True

while running:
    if game_state == "menu":
        play_button_rect, store_icon_rect = draw_menu()
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            elif event.type == pygame.MOUSEBUTTONDOWN:
                if play_button_rect.collidepoint(event.pos):
                    reset_game()
                    game_state = "playing"
                elif store_icon_rect.collidepoint(event.pos):
                    game_state = "store"

    elif game_state == "store":
        back_button_rect, option_rects = draw_store()
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            elif event.type == pygame.MOUSEBUTTONDOWN:
                # Check color selection
                for rect, color_val in option_rects:
                    if rect.collidepoint(event.pos):
                        snake_color = color_val
                # Check "Back" button
                if back_button_rect.collidepoint(event.pos):
                    game_state = "menu"
        clock.tick(30)

    elif game_state == "playing":
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = event.pos
                head_x, head_y = snake.body[0]
                grid_x = x // GRID_SIZE
                grid_y = (y - 100) // GRID_SIZE
                if grid_y >= 0:
                    dx, dy = grid_x - head_x, grid_y - head_y
                    if abs(dx) > abs(dy):
                        new_dir = RIGHT if dx > 0 else LEFT
                    else:
                        new_dir = DOWN if dy > 0 else UP
                    if new_dir != OPPOSITE[snake.direction]:
                        snake.direction = new_dir

        snake.move()

        # Check self-collision
        if snake.body[0] in snake.body[1:]:
            game_state = "game_over"
            continue

        # Check obstacle collision
        if snake.body[0] in obstacles:
            # If snake has more than one segment, remove one segment
            if len(snake.body) > 1:
                snake.body.pop()
            else:
                game_state = "game_over"
                continue

        # Check food collision
        if snake.body[0] == food.position:
            snake.grow()
            apple_count += 1

            # Score logic
            if bonus_active:
                score += 30
                bonus_active = False
            else:
                score += 10

            # Add new obstacle if fewer than 10
            add_obstacle()

            # Respawn food
            food.respawn()

            # Check bonus
            if apple_count == 3:
                bonus_active = True
                apple_count = 0

            # Increase level every 50 points
            if score % 50 == 0:
                level += 1
                speed += 2

        # Draw the game
        screen.fill(SCOREBOARD_BG, (0, 0, WIDTH, 100))
        screen.blit(grass_bg, (0, 100))

        # Draw snake
        for seg in snake.body:
            pygame.draw.rect(screen, snake_color, (seg[0] * GRID_SIZE, 100 + seg[1] * GRID_SIZE, GRID_SIZE, GRID_SIZE))

        # Draw food
        if food.position:
            pygame.draw.rect(screen, RED, (food.position[0] * GRID_SIZE, 100 + food.position[1] * GRID_SIZE, GRID_SIZE, GRID_SIZE))

        # Draw obstacles
        for obs in obstacles:
            x, y = obs
            pygame.draw.rect(screen, GRAY, (x * GRID_SIZE, 100 + y * GRID_SIZE, GRID_SIZE, GRID_SIZE))

        # Display score and level
        score_text = font.render(f"Score: {score}  Level: {level}", True, BLACK)
        screen.blit(score_text, (10, 10))

        # Bonus message
        if bonus_active:
            bonus_text = font.render("ðŸ”¥ 3Ã— BONUS ACTIVE! ðŸ”¥", True, GOLD)
            screen.blit(bonus_text, (WIDTH // 2 - bonus_text.get_width() // 2, 10))

        pygame.display.flip()
        clock.tick(speed)

    elif game_state == "game_over":
        draw_game_over()
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            elif event.type == pygame.MOUSEBUTTONDOWN:
                # Return to menu
                game_state = "menu"

pygame.quit()
sys.exit()
        
    </script>
</body>
</html>